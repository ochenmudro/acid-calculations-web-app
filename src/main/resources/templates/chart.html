<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Калибровка</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" th:href="@{/css/navbar.css}">
</head>

<body>

  <div th:replace="navbar :: navbar"></div>

  <div class="container py-5">
    <div class="row">
      <div class="col-md-6 mx-auto text-center">
        <h2>у = <span th:text="${coefficient}"></span>х</h2>
        <canvas id="myChart"></canvas>
      </div>
    </div>
  </div>

  <script th:inline="javascript">

    var concentrationValues = /*[[${concentrationValues}]]*/[];
    var peakAreaValues = /*[[${peakAreaValues}]]*/[];
    var trendLineValues = /*[[${trendLineValues}]]*/[];
    var image;

    var ctx = document.getElementById('myChart').getContext('2d');

    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: concentrationValues,
        datasets: [{
          data: peakAreaValues,
          borderColor: 'rgb(255, 99, 132)',
          borderWidth: 2,
          fill: false
        },
        {
          data: trendLineValues,
          borderColor: 'green',
          borderWidth: 2,
          fill: false,
          borderDash: [5, 5]
        }]
      },
      options: {
        legend: {
          display: false
        },
        scales: {
          xAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Концентрация'
            }
          }],
          yAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Площадь пика'
            }
          }]
        },
        animation: {
          onComplete: function () {
            image = myChart.toBase64Image();
            var requestData = new FormData();
            requestData.append('image', image);

            fetch('saveChartImage', {
              method: 'POST',
              body: requestData
            })
              .then(function (response) {
                if (response.ok) {
                  console.log('График успешно сохранен');
                } else {
                  console.error('Ошибка при сохранении графика');
                }
              })
              .catch(function (error) {
                console.error('Произошла ошибка', error);
              });
          }
        }
      }
    });

  </script>

  <script th:src="@{/js/navbar.js}"></script>
</body>

</html>